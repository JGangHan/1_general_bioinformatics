
## SAM（Sequence Alignment/Map） 和 BAM（Binary Alignment/Map） 文件
**BAM文件格式是存储比对（alignment）信息的标准格式，它是 SAM格式的二进制版本，由头部（Header）和比对记录（Alignment Records）部分组成**  
1. 头部：以“@”开头，常见的标记包括：
- @HD：文件头，描述了版本号和排序信息。
- @SQ：参考序列信息，每个参考序列对应一行，包含序列名称（SN）和长度（LN）
- @RG：读组（Read Group）信息，用于描述不同批次、样本或文库。
- @PG：比对软件（Program）信息，记录调用工具和版本。
```
@HD	VN:1.0	SO:coordinate
@SQ	SN:1	LN:301310028
@SQ	SN:2	LN:265688840
@SQ	SN:3	LN:241140967
@SQ	SN:4	LN:130071916
@SQ	SN:5	LN:117625568
@SQ	SN:6	LN:129788820
@SQ	SN:7	LN:107697089
.... 其他染色体 ..........
@PG	ID:hisat2	PN:hisat2	VN:2.2.1	CL:"/home/hanjiangang/software/hisat2-2.2.1/hisat2-align-s --wrapper basic-0 -p 20 --dta -x /home/hanjiangang/bulk_rna_seq/ref_genome/Oaries_rambouillet_v1_103 --summary-file ./d0_1_summary.txt -S d0_1.sam --read-lengths 150 -1 /tmp/32657.inpipe1 -2 /tmp/32657.inpipe2"
```
2. 比对记录：每条比对记录描述了一个测序读段（read）与参考基因组的比对情况，标准比对记录至少包含 11 个必选字段，除必选字段外，还可以包含若干个可选字段（TAG）

QNAME：查询模板名称（Read Name）。

FLAG：比对标记（Bitwise Flag），描述读段的各种状态（如是否为配对、正向或反向比对等）。

RNAME：比对到的参考序列名称。

POS：比对起始位置（1-based）。

MAPQ：比对质量值。

CIGAR：比对字符串，描述匹配、插入、删除、剪切等操作，例如 "50M" 表示 50 个碱基的连续匹配。

RNEXT：下一个配对读段所在的参考序列名称（通常为 "=" 表示与当前读段相同）。

PNEXT：下一个配对读段的比对起始位置。

TLEN：模板长度，用于描述配对读段的插入片段大小。

SEQ：读段的碱基序列。

QUAL：读段碱基的质量值，通常以 ASCII 字符表示。


A01046:73:H3WN2DSX2:4:2159:3115:34287	163	1	34920	60	150M	=	35119	349	TCCGCTCTAAACCGCAAAGCTAGCCCTTCTTTTTTCAAGGTTTCCCATTTAGGGCCCCACACATGTCCATTAAGTCAGTGATGCCATTCAACCATCTCCTCCTCTATCGTCCCCTTCTCCTCCTGCCTTCAGTCTTTCGCAGCATCAGGG	FFFFFFFFFFFFFFF:,FFFFFFF:FFFFFFFFF,FFFFFFFFFFFF,FFFF,FFFFFFFFF:FF,FFFFFFF:F,FFFFFFFFFFFFFFFFFF::FFF,F::FFFF:F,F,FFF:FFFFFFF::FF,FFFF:F:FFFFFFFFF,FF,,F	AS:i:0	ZS:i:-3	XN:i:0	XM:i:0	XO:i:0	XG:i:0	NM:i:0	MD:Z:150	YS:i:0	YT:Z:CP	NH:i:1
A01046:73:H3WN2DSX2:4:2623:10447:18865	163	1	35070	60	2S148M	=	35123	203	GTTTTTTTCCAATGAGTCAGGTCTTCCCATCAGGTGGCCAAAGTATTGGAGCTTCAGCACCAGTCCTTCCAATGTATATTCAGGGTTGATTTCCTTTAGGATTGACTGGTTTGATCTCCTTGCTGTACAAGGGACTCTCAAGAGTCTTCT	FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF:FF,FFFFFFFFFFFFFFFFFFFFFF:FFFFFFFFFFFFFFFFFFFFFF::FFFFFFFF,FFFFFFFFFFF:FFFFFF	AS:i:-12	ZS:i:-17	XN:i:0	XM:i:2	XO:i:0	XG:i:0	NM:i:2	MD:Z:9G42T95	YS:i:-2	YT:Z:CP	NH:i:1
A01046:73:H3WN2DSX2:4:1403:21694:10379	163	1	35095	60	150M	=	35193	248	CATCAGGTGGCCAAAGTATTGGAGCTTTAGCACCAGTCCTTCCAATGTATCTTCAGGGTTGATTTCCTTTAGGATTGACTGGTTTGATCTCCTTGCTGTCCAAGGGACTCTCAAGAGTCTTCTCCAACTCCACAGTTCAAAAGCATCAAT	FFFFFFFFF:FFFFFFFFFFFFFFFFF:FFFF,FFFFF,FFF:FFFFFFF,FFFFF,FFFFF,FFFFFFFF:::FFFF,FFFFFFF,FFFFFFFF,,FF,:FFFFFFF,FFFFFFFFFF,FFFFFF:F,FFFFFFF,FFF:FFFFFFF:F	AS:i:-9	ZS:i:-28	XN:i:0	XM:i:3	XO:i:0	XG:i:0	NM:i:3	MD:Z:50A48A28A21	YS:i:0	YT:Z:CP	NH:i:1
A01046:73:H3WN2DSX2:4:2159:3115:34287	83	1	35119	60	150M	=	34920	-349	CTTTAGCACCAGTCCTTCCAATGTATATTCAGGGTTGATTTCCTTTAGGATTGACTGGTTTGATCTCCTTGCTGTACAAGGGACTCTCAAGAGTCTTCTCCAACACCACAGTTCAAAAGCATCAATTTTCAGTGTTCAGCCTTCTTTAGG	FFFFFFFFFFFFFFFFFFFFF,:FFFFFFFFFFFFFFFF:FFFFFF,FFFFFFFFFFFFFFFFFFFFF:FFFFFFFFFFFFFFFFFFFFFFFFFF:FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF:FFFFFFFFFF	AS:i:0	XN:i:0	XM:i:0	XO:i:0	XG:i:0	NM:i:0	MD:Z:150	YS:i:0	YT:Z:CP	NH:i:1
A01046:73:H3WN2DSX2:4:2623:10447:18865	83	1	35123	60	2S148M	=	35070	-203	TCAGCACCAGTCCTTCCAATGTATATTCAGGGTTGATTTCCTTTAGGATTGACTGGTTTGATCTCCTTGCTGTACAAGGGACTCTCAAGAGTCTTCTCCAACACCACAGTTCAAAAGCATCAATTTTCAGTGTTCAGCCTTCTTTAGGGG	:FFFFFFFFFFFF:FFFF:FFFFFFFFFFFFFFFFFFFFFFFF:FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF,FFFFFFF	AS:i:-2	XN:i:0	XM:i:0	XO:i:0	XG:i:0	NM:i:0	MD:Z:148	YS:i:-12	YT:Z:CP	NH:i:1
A01046:73:H3WN2DSX2:4:2137:28800:35399	81	1	35132	60	150M	PEKD01006513.1	8689	0	CCTTCCAATGTATATTCAGGGTTGATTTCCTTTAGGATTGACTGGTTTGATCTCCTTGCTGTACAAGGGACTCTCAAGAGTCTTCTCCAACACCACAGTTCAAAAGCATCAATTTTCAGTGTTCAGCCTTCTTTAGGGGCCAACTCTCAC	FFFFFFF::FFFFFFFFFFFFFFFFF:FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF,FFFFFFFFFFFF::,FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF	AS:i:0	XN:i:0	XM:i:0	XO:i:0	XG:i:0	NM:i:0	MD:Z:150	YT:Z:UP	NH:i:1
A01046:73:H3WN2DSX2:4:2137:28727:35712	113	1	35132	60	150M	PEKD01004933.1	5795	0	CCTTCCAATGTATATTCAGGGTTGATTTCCTTTAGGATTGACTGGTTTGATCTCCTTGCTGTACAAGGGACTCTCAAGAGTCTTCTCCAACACCACAGTTCAAAAGCATCAATTTTCAGTGTTCAGCCTTCTTTAGGGGCCAACTCTCAC	FFFFFF::FFFFFFFFF:FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF:FFFFFFFFFFFFF:FFFFFFFFFFFFFFFFF:FFFFFFFFFFFFFFFFFFFFFFFFFFFF	AS:i:0	XN:i:0	XM:i:0	XO:i:0	XG:i:0	NM:i:0	MD:Z:150	YT:Z:UP	NH:i:1
A01046:73:H3WN2DSX2:4:2556:1741:22106	81	1	35132	60	150M	PEKD01006513.1	8689	0	CCTTCCAATGTATATTCAGGGTTGATTTCCTTTAGGATTGACTGGTTTGATCTCCTTGCTGTACAAGGGACTCTCAAGAGTCTTCTCCAACACCACAGTTCAAAAGCATCAATTTTCAGTGTTCAGCCTTCTTTAGGGGCCAACTCTCAC	FF:FF,F,F:FFFFFFFFFF:FF::FFF:FFFFF,FFFFFFFFFFFFFFFFFF:FFFFFFFFFF,:FF,FFFFFFFFFFFF:FFFFFFFFF:,:FFF:FFFFFF:FFFFFFFFFFFFFFFFFFFFFFF:FFFF:FFF:FF::FFFFF:F:	AS:i:0	XN:i:0	XM:i:0	XO:i:0	XG:i:0	NM:i:0	MD:Z:150	YT:Z:UP	NH:i:1
A01046:73:H3WN2DSX2:4:1403:21694:10379	83	1	35193	60	129M2204N21M	=	35095	-248	TACAAGGGACTCTCAAGAGTCTTCTCCAACACCACAGTTCAAAAGCATCAATTTTCAGTGTTCAGCCTTCTTTAGGGGCCAACTCTCACATCTGTACGTGACTACTGGGAAAACCATAGGGTTTGACCCCACAAAGGGCGTTCATGTCAC	FFF:FF:FFF:F,FFFFFFFFFFFFFFFFFFFF,FF,F::FFF:FFFFF:FFFFFFFFFFFFFFF:FFFF,FFFFFFFFFF:FFFFFFFFFF:FFFFFFFFFFFFFF,FFFFFFF,,FFF::FFFFFFF:F:FFF,F:FFFFFFFF:F:F	AS:i:0	ZS:i:-11	XN:i:0	XM:i:0	XO:i:0	XG:i:0	NM:i:0	MD:Z:150	YS:i:-9	YT:Z:CP	XS:A:-	NH:i:1
A01046:73:H3WN2DSX2:4:1608:30698:5055	99	1	36218	60	150M	=	36543	475	GTTCAAATGCGCTGAGACCCTCAGTGTTCACTTGCTAATCGCCTCCAGAAACCCTGTTCTCCTCGAGTGACAAGGTCAGCAGGGCAGCACGTGTGTTCCTGTCACTGCCAACTCAAAATATGAAGTTTAAAGAGTTTCACAATCAAATGC	FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF


## vcf（Variant Call Format）文件
**用于存储基因组变异信息的标准文件格式，包括单核苷酸多态性（SNPs）、插入缺失（INDELs）等基因组变异信息。**  
**由头部（Header）和变异数据（Body）两部分组成**  
1. 头部：元信息行（Meta-information lines），##；列标题行（Column header line），#。
```
##fileformat=VCFv4.2
##reference=GRCh38
##contig=<ID=1,length=248956422>
##INFO=<ID=DP,Number=1,Type=Integer,Description="Total Depth">
##FORMAT=<ID=GT,Number=1,Type=String,Description="Genotype">

#CHROM  POS     ID      REF     ALT     QUAL    FILTER  INFO    FORMAT  sample1 sample2
```
- CHROM：染色体名称或序列名称（例如 1, X, chr2 等）。
- POS：变异的位置，指示变异在染色体上的起始位置。
- ID：变异的标识符，通常是 dbSNP 的 rsID，如 rs12345。如果没有标识符，则用 . 表示。
- REF：参考基因组中该位置的碱基或碱基序列。
- ALT：变异的碱基或碱基序列，可能是单一的替代碱基，也可以是多种碱基的组合。
- QUAL：质量值，表示变异的置信度。较高的值通常表示较高的可信度。
- FILTER：该变异是否通过过滤。常见的值是 PASS，表示该变异通过了质量控制；其他值（如 LowQual）表示未通过过滤。
- INFO：变异的其他信息，通常是以键值对形式表示，例如变异深度（DP）、变异类型（Type）等。
- FORMAT：指定样本基因型信息的格式。通常包含诸如基因型（GT）、深度（DP）、基因型质量（GQ）等字段。
- 样本列（sample1, sample2, ...）：每个样本的基因型信息。基因型通常以 0/0（纯合参考）、0/1（杂合）、1/1（纯合变异）等表示，同时冒号后显示基因频率（1/1:20,80），多个样本之间由制表符分隔。

2. 数据部分:列出每个变异的具体信息。每一行对应一个变异，列按照头部的列标题顺序排列。
- SNP 信息（除SNP外，还有SV、Indel等多种形式）  
```
##fileformat=VCFv4.2
##source=MyVariantCaller
##INFO=<ID=DP,Number=1,Type=Integer,Description="Total Depth">
##FORMAT=<ID=GT,Number=1,Type=String,Description="Genotype">
##FORMAT=<ID=AD,Number=R,Type=Integer,Description="Allelic depths for the ref and alt alleles">
#CHROM  POS     ID      REF     ALT     QUAL    FILTER  INFO        FORMAT          Sample1         Sample2         Sample3
chr1    123456  .       A       G       50      PASS    DP=100      GT:AD           0/1:60,40      1/1:20,80      0/0:90,10
chr1    123789  .       T       C       99      PASS    DP=80       GT:AD           0/0:70,10      0/1:40,40      0/1:50,30
chr2    234567  .       G       A       70      PASS    DP=95       GT:AD           1/1:15,80      0/1:50,45      0/1:60,35
```

## PED MAP 文件
PED 文件（Pedigree）包含了个体的基因型数据，其中的基因型通常通过标记ID与MAP文件中的SNP对应。
MAP 文件提供了这些SNP在基因组中的位置信息。

PED 文件记录了家族和基因型数据，主要用于群体遗传学、连锁分析、基因型-表型关联等研究。每一行都代表一个个体，个体信息包含家谱信息（父母ID、性别、表型）以及该个体在不同SNP位点上的基因型。PED 文件通常与 MAP 文件 配合使用，后者提供了SNP标记的位置信息。
FAM001  1  0  0  1  2  A/A A/G
FAM001  2  0  0  2  2  A/A A/A
FAM001  3  1  2  1  2  A/G A/G
FAM001  4  1  2  2  1  G/G A/G
FAM002  5  0  0  1  -9  A/A G/G
FAM002  6  5  0  2  2  A/G G/G

Family ID：家庭编号，指同一家族中的个体共享的ID。
Individual ID：个体的唯一标识符。
Paternal ID：父亲的ID，如果父亲不存在则填为 0。
Maternal ID：母亲的ID，如果母亲不存在则填为 0。
Sex：性别（1 = 雄性，2 = 雌性，0 = 未知性别）。
Phenotype：表型（通常 1 表示患病/有特征，2 表示正常，无特征，-9 表示缺失值）。
Genotype：基因型数据，基因型以两个等位基因对表示，基因型由父母遗传给个体的等位基因组成。







MAP 文件是一个文本文件，每行描述一个 遗传标记（通常是SNP）的位置
例：
1    rs12345    0.0    10000
1    rs67890    1.2    20000
2    rs11121    0.5    15000
列1：Chromosome
列2：SNP_ID
列3：Genetic_Distance：标记与其他基因或SNP之间的遗传距离。通常以摩根（Morgans）为单位，用于反映基因或标记在染色体上的重组频率。
列4：Physical_Position：标记在染色体上的物理位置，表示该SNP在染色体上的具体位置。





```


## 查看 bam 文件
samtools view -H <file.bam>       # 查看头部文件
samtools view <file.bam> | less
nohup samtools sort -@ 8 -t CB -O BAM -o cellsorted_possorted_genome_bam.bam possorted_genome_bam.bam > 1.txt &


## samtools 常用命令
samtools view 
### 排序
samtools sort 
samtools sort -@ 8 -t CB -O BAM -o <sorted_file.bam> <file.bam>   # 大文件需要用 nohup 挂起


```







